---
const defaultLocale = 'en';
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Redirecting...</title>
    <meta name="robots" content="noindex" />
    <link rel="canonical" href="https://novameat.com/en" />
    <script>
      function shouldRedirect() {
        const path = window.location.pathname;

        // Solo redirigir si estamos exactamente en `/`
        if (path !== '/') {
          console.log("✅ Ya estamos en idioma o subpágina:", path);
          return false;
        }

        const alreadyRedirected = sessionStorage.getItem('redirectedToLocale');
        if (alreadyRedirected) {
          console.log('⏸️ Ya redirigido. No se vuelve a redirigir.');
          return false;
        }

        return true;
      }

      function redirectToDefaultLocale() {
        if (!shouldRedirect()) return;

        const fromOutside = document.referrer === '' || !document.referrer.startsWith(window.location.origin);
        const destination = '/en';

        sessionStorage.setItem('redirectedToLocale', 'true');

        if (fromOutside) {
          console.log('🚀 Redirigiendo a', destination, '(desde fuera)');
          window.location.href = destination;
        } else {
          console.log('🔁 Redirigiendo a', destination, '(desde dentro)');
          window.location.replace(destination);
        }
      }

      window.addEventListener('pageshow', () => {
        redirectToDefaultLocale();
      });

      setTimeout(redirectToDefaultLocale, 100);
    </script>
  </head>
  <body>
    <p>Redirecting to /en...</p>
  </body>
</html>
